cmake_minimum_required(VERSION 3.16)
project(easyPyEngine C)

set(CMAKE_C_STANDARD 17)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Python
find_package(Python3 COMPONENTS Interpreter Development REQUIRED)

# SDL2 (via pkg-config for reliability on macOS/Homebrew)
find_package(PkgConfig REQUIRED)
pkg_check_modules(SDL2 REQUIRED sdl2)
pkg_check_modules(SDL2_IMAGE REQUIRED SDL2_image)

file(GLOB SRC_FILES src/*.c python/easyPyEngineModule.c)
add_library(easyPyEngine MODULE ${SRC_FILES})

# Shared object naming for Python module
set_target_properties(easyPyEngine PROPERTIES
    PREFIX ""
)

# Includes
target_include_directories(easyPyEngine PRIVATE
    ${Python3_INCLUDE_DIRS}
    ${SDL2_INCLUDE_DIRS}
    ${SDL2_IMAGE_INCLUDE_DIRS}
    include
)
# Explicit paths for Homebrew SDL2 libs
set(SDL2_LIB_PATH /opt/homebrew/lib/libSDL2.dylib)
set(SDL2_IMAGE_LIB_PATH /opt/homebrew/lib/libSDL2_image.dylib)

target_link_libraries(easyPyEngine PRIVATE
    ${Python3_LIBRARIES}
    ${SDL2_LIB_PATH}
    ${SDL2_IMAGE_LIB_PATH}
)


# Explicitly tell the linker where Homebrew keeps libraries
link_directories(/opt/homebrew/lib)
